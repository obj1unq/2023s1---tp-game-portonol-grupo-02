import wollok.game.*
import Movement.*
import Entities.*
import gameConfig.*
import structureGenerator.*
import enemiesFactories.*
import Global.*

describe "Player Tests" {
	
	const gravity = new GravityController(name = "mainGravity", tickTime = 100, gameInstance = game)
	const player = new PlayerDamageEntity(baseImageName = "player", gravity = gravity, maxHp = 100, damage = 0, cooldown = 200, damageSfx = null, deathSfx = null)
	const controller = new CollidableMovementController(movableEntity = player)
	
	method initialize(){
		game.clear()
		game.width(20)
		game.height(11)
		global.player(player)
		global.gravity(gravity)
		player.changeMovementController(controller)
		gravity.init()
		player.initialPositions(2, 2)
		player.onAttach()
	}
	
	test "Player moves" {
		controller.goUp(2)
		assert.equals(4, player.position().y())
		controller.goDown(2)
		assert.equals(2, player.position().y())
		controller.goRight(2)
		assert.equals(4, player.position().x())
		controller.goLeft(2)
		assert.equals(2, player.position().x())
	}
	
	test "Player can't move out the map limits" {
//		controller.goRight(8)
//		assert.equals(18, player.position().x())
//		assert.that(controller.canMoveTo(right))
		assert.that(false)
	}
	
	test "Enemy damages player" {
		var enemy = flyEnemyFactory.generate(1, 1)
		enemy.initialPositions(2, 2)
		enemy.onAttach()
		assert.equals(80, player.hp())
	}
	
}